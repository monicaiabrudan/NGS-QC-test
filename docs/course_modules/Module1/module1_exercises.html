<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Exercises – NGS Bioinformatics course</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../course_modules/Module2/module2_manual.html" rel="next">
<link href="../../course_modules/Module1/module1_manual.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">NGS Bioinformatics course</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-modules" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Modules</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-modules">    
        <li>
    <a class="dropdown-item" href="../../course_modules/Module1/module1.html">
 <span class="dropdown-text">File formats</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course_modules/Module2/module2.html">
 <span class="dropdown-text">Reads alignment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course_modules/Module3/module3.html">
 <span class="dropdown-text">Variant calling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course_modules/Module4/module4.html">
 <span class="dropdown-text">Structural Variation Calling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course_modules/Module5/module5.html">
 <span class="dropdown-text">Genome assembly</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course_modules/Module6/module6.html">
 <span class="dropdown-text">RNA-seq</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course_modules/Module7/module7.html">
 <span class="dropdown-text">CHiP-Seq</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course_modules/Glossary/glossary.html">
 <span class="dropdown-text">Glossary of terms</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../course_modules/Module1/module1_manual.html">File formats</a></li><li class="breadcrumb-item"><a href="../../course_modules/Module1/module1_exercises.html">Exercises</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">File formats</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../course_modules/Module1/module1_manual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manual</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../course_modules/Module1/module1_exercises.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Exercises</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Read alignment</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../course_modules/Module2/module2_manual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manual</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../course_modules/Module2/module2_exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercises</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Variant calling</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../course_modules/Module3/module3_manual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manual</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../course_modules/Module3/module3_exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercises</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Structural Variation Calling</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../course_modules/Module4/module4_manual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manual</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../course_modules/Module4/module4_exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercises</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Genome Assembly</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../course_modules/Module5/module5_manual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manual</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../course_modules/Module5/module5_exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercises</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">RNA-Seq</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../course_modules/Module6/module6_manual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manual</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../course_modules/Module6/module6_exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercises</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false">
 <span class="menu-text">CHiP-Seq</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../course_modules/Module7/module7_manual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manual</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../course_modules/Module7/module7_exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercises</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#ngs-data-formats-and-qc" id="toc-ngs-data-formats-and-qc" class="nav-link active" data-scroll-target="#ngs-data-formats-and-qc">NGS Data formats and QC</a>
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#tutorial-sections" id="toc-tutorial-sections" class="nav-link" data-scroll-target="#tutorial-sections">Tutorial sections</a></li>
  <li><a href="#running-the-commands-from-this-tutorial" id="toc-running-the-commands-from-this-tutorial" class="nav-link" data-scroll-target="#running-the-commands-from-this-tutorial">Running the commands from this tutorial</a></li>
  <li><a href="#lets-get-started" id="toc-lets-get-started" class="nav-link" data-scroll-target="#lets-get-started">Let’s get started!</a></li>
  </ul></li>
  <li><a href="#data-formats-for-ngs-data" id="toc-data-formats-for-ngs-data" class="nav-link" data-scroll-target="#data-formats-for-ngs-data">Data formats for NGS data</a>
  <ul class="collapse">
  <li><a href="#fasta" id="toc-fasta" class="nav-link" data-scroll-target="#fasta">FASTA</a></li>
  <li><a href="#fastq" id="toc-fastq" class="nav-link" data-scroll-target="#fastq">FASTQ</a></li>
  <li><a href="#sam" id="toc-sam" class="nav-link" data-scroll-target="#sam">SAM</a></li>
  <li><a href="#cigar-string" id="toc-cigar-string" class="nav-link" data-scroll-target="#cigar-string">CIGAR string</a></li>
  <li><a href="#bam" id="toc-bam" class="nav-link" data-scroll-target="#bam">BAM</a></li>
  <li><a href="#cram" id="toc-cram" class="nav-link" data-scroll-target="#cram">CRAM</a></li>
  <li><a href="#indexing" id="toc-indexing" class="nav-link" data-scroll-target="#indexing">Indexing</a></li>
  <li><a href="#vcf" id="toc-vcf" class="nav-link" data-scroll-target="#vcf">VCF</a></li>
  <li><a href="#vcf-header" id="toc-vcf-header" class="nav-link" data-scroll-target="#vcf-header">VCF header</a></li>
  <li><a href="#body" id="toc-body" class="nav-link" data-scroll-target="#body">Body</a></li>
  <li><a href="#bcf" id="toc-bcf" class="nav-link" data-scroll-target="#bcf">BCF</a></li>
  <li><a href="#bcftools-view" id="toc-bcftools-view" class="nav-link" data-scroll-target="#bcftools-view">bcftools view</a></li>
  <li><a href="#bcftools-query" id="toc-bcftools-query" class="nav-link" data-scroll-target="#bcftools-query">bcftools query</a></li>
  <li><a href="#gvcf" id="toc-gvcf" class="nav-link" data-scroll-target="#gvcf">gVCF</a></li>
  <li><a href="#qc-assessment-of-ngs-data" id="toc-qc-assessment-of-ngs-data" class="nav-link" data-scroll-target="#qc-assessment-of-ngs-data">QC assessment of NGS data</a></li>
  <li><a href="#base-quality" id="toc-base-quality" class="nav-link" data-scroll-target="#base-quality">Base quality</a></li>
  <li><a href="#other-base-calling-errors" id="toc-other-base-calling-errors" class="nav-link" data-scroll-target="#other-base-calling-errors">Other base calling errors</a></li>
  <li><a href="#mismatches-per-cycle" id="toc-mismatches-per-cycle" class="nav-link" data-scroll-target="#mismatches-per-cycle">Mismatches per cycle</a></li>
  <li><a href="#gc-content-by-cycle" id="toc-gc-content-by-cycle" class="nav-link" data-scroll-target="#gc-content-by-cycle">GC content by cycle</a></li>
  <li><a href="#fragment-size" id="toc-fragment-size" class="nav-link" data-scroll-target="#fragment-size">Fragment size</a></li>
  <li><a href="#insertionsdeletions-per-cycle" id="toc-insertionsdeletions-per-cycle" class="nav-link" data-scroll-target="#insertionsdeletions-per-cycle">Insertions/Deletions per cycle</a></li>
  <li><a href="#generating-qc-stats" id="toc-generating-qc-stats" class="nav-link" data-scroll-target="#generating-qc-stats">Generating QC stats</a></li>
  <li><a href="#summary-numbers-sn" id="toc-summary-numbers-sn" class="nav-link" data-scroll-target="#summary-numbers-sn">Summary Numbers (SN)</a></li>
  <li><a href="#generating-qc-plots" id="toc-generating-qc-plots" class="nav-link" data-scroll-target="#generating-qc-plots">Generating QC plots</a></li>
  </ul></li>
  <li><a href="#file-conversion" id="toc-file-conversion" class="nav-link" data-scroll-target="#file-conversion">File conversion</a>
  <ul class="collapse">
  <li><a href="#sam-to-bam" id="toc-sam-to-bam" class="nav-link" data-scroll-target="#sam-to-bam">SAM to BAM</a></li>
  <li><a href="#bam-to-cram" id="toc-bam-to-cram" class="nav-link" data-scroll-target="#bam-to-cram">BAM to CRAM</a></li>
  <li><a href="#fastq-to-sam" id="toc-fastq-to-sam" class="nav-link" data-scroll-target="#fastq-to-sam">FASTQ to SAM</a></li>
  <li><a href="#cram-to-fastq" id="toc-cram-to-fastq" class="nav-link" data-scroll-target="#cram-to-fastq">CRAM to FASTQ</a></li>
  <li><a href="#vcf-to-bcf" id="toc-vcf-to-bcf" class="nav-link" data-scroll-target="#vcf-to-bcf">VCF to BCF</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../course_modules/Module1/module1_manual.html">File formats</a></li><li class="breadcrumb-item"><a href="../../course_modules/Module1/module1_exercises.html">Exercises</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Exercises</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="ngs-data-formats-and-qc" class="level2">
<h2 class="anchored" data-anchor-id="ngs-data-formats-and-qc">NGS Data formats and QC</h2>
<section id="introduction" class="level3">
<h3 class="anchored" data-anchor-id="introduction">Introduction</h3>
<p>There are several file formats for storing Next Generation Sequencing (NGS) data. In this tutorial we will look at some of the most common formats for storing NGS reads and variant data. We will cover the following formats:</p>
<p>FASTQ - This format stores unaligned read sequences with base qualities</p>
<p>SAM/BAM - This format stores unaligned or aligned reads (text and binary formats)</p>
<p>CRAM - This format is similar to BAM but has better compression than BAM</p>
<p>VCF/BCF - Flexible variant call format for storing SNPs, indels, structural variations (text and binary formats)</p>
<p>Following this, we will work through some examples of converting between the different formats.</p>
<p>Further to understanding the different file formats, it is important to remember that all sequencing platforms have technical limitations that can introduce biases in your sequencing data. Because of this it is very important to check the quality of the data before starting any analysis, whether you are planning to use something you have sequenced yourself or publicly available data. In the latter part of this tutorial we will describe how to perform a QC assessment for your NGS data.</p>
</section>
<section id="tutorial-sections" class="level3">
<h3 class="anchored" data-anchor-id="tutorial-sections">Tutorial sections</h3>
<p>This tutorial comprises the following sections:</p>
<p>1. Data formats</p>
<p>2. QC assessment</p>
<p>If you have time you can also complete:</p>
<p>3. File conversion</p>
</section>
<section id="running-the-commands-from-this-tutorial" class="level3">
<h3 class="anchored" data-anchor-id="running-the-commands-from-this-tutorial">Running the commands from this tutorial</h3>
<p>You can follow this tutorial by typing all the commands you see into a terminal window. This is similar to the “Command Prompt” window on MS Windows systems, which allows the user to type DOS commands to manage files.</p>
<p>To get started, open a new terminal on your computer and type the command below:</p>
<p><code>cd ~/course-data/data_formats/</code></p>
<p>Now you can follow the instructions in the tutorial from here.</p>
</section>
<section id="lets-get-started" class="level3">
<h3 class="anchored" data-anchor-id="lets-get-started">Let’s get started!</h3>
<p>This tutorial assumes that you have <strong>samtools</strong>, <strong>bcftools</strong> and <strong>Picard</strong> tools installed on your computer.</p>
<p>These are already installed on the VM you are using. To check that these are installed, you can run the following commands:</p>
<p><code>samtools --help</code></p>
<p><code>bcftools --help</code></p>
<p><code>picard -h</code></p>
<p>This should return the help message for samtools, bcftools and picard tools respectively.</p>
<p>To get started with the tutorial, go to the first section: Data formats</p>
</section>
</section>
<section id="data-formats-for-ngs-data" class="level2">
<h2 class="anchored" data-anchor-id="data-formats-for-ngs-data">Data formats for NGS data</h2>
<p>Here we will take a closer look at some of the most common NGS data formats. First, check you are in the correct directory:</p>
<p><code>pwd</code></p>
<p>It should display something like:</p>
<p><code>/home/manager/course_data/data_formats/</code></p>
<section id="fasta" class="level3">
<h3 class="anchored" data-anchor-id="fasta">FASTA</h3>
<p><strong>Q1: How many sequences are there in the fasta file <code>data/example.fasta</code>? (Hint: is there a grep option you can use?)</strong></p>
</section>
<section id="fastq" class="level3">
<h3 class="anchored" data-anchor-id="fastq">FASTQ</h3>
<p><strong>Q2: How many reads are there in the file example.fastq? (Hint: remember that @ is a possible quality score. Is there something else in the header that is unique?)</strong></p>
</section>
<section id="sam" class="level3">
<h3 class="anchored" data-anchor-id="sam">SAM</h3>
<p><strong>Look at the following line from the header of a SAM file and answering the questions that follow:</strong></p>
<p>@RG ID:ERR003612 PL:ILLUMINA LB:g1k-sc-NA20538-TOS-1 PI:2000 DS:SRP000540 SM:NA20538 CN:SC</p>
<p><strong>Q3: What does RG stand for?</strong></p>
<p><strong>Q4: What is the sequencing platform?</strong></p>
<p><strong>Q5: What is the sequencing centre?</strong></p>
<p><strong>Q6: What is the lane identifier?</strong></p>
<p><strong>Q7: What is the expected fragment insert size?</strong></p>
<p>Let’s have a look at <em>example.sam</em>. Notice that we can use the standard UNIX operations like cat on this file.</p>
<p><code>cat data/example.sam</code></p>
<p><strong>Q8: What is the mapping quality of ERR003762.5016205? (Hint: can you use grep and awk to find this?)</strong></p>
<p><strong>Q9: What is the CIGAR string for ERR003814.6979522? (Hint: we will go through the meaning of CIGAR strings in the next section)</strong></p>
<p><strong>Q10: What is the inferred insert size of ERR003814.1408899?</strong></p>
</section>
<section id="cigar-string" class="level3">
<h3 class="anchored" data-anchor-id="cigar-string">CIGAR string</h3>
<p><strong>Q11: What does the CIGAR from Q9 mean?</strong></p>
<p><strong>Q12: How would you represent the following alignment with a CIGAR string?</strong></p>
<p>Ref: ACGT- - - - ACGTACGT</p>
<p>Read: ACGTACGTACGTACGT</p>
</section>
<section id="bam" class="level3">
<h3 class="anchored" data-anchor-id="bam">BAM</h3>
<p>BAM (Binary Alignment/Map) format, is a compressed binary version of SAM. This means that, while SAM is human readable, BAM is only readable for computers. BAM files can be viewed using samtools, and will then have the same format as a SAM file. The key features of BAM are:</p>
<p>• Can store alignments from most mappers</p>
<p>• Supports multiple sequencing technologies</p>
<p>• Supports indexing for quick retrieval/viewing</p>
<p>• Compact size (e.g.&nbsp;112Gbp Illumina = 116GB disk space)</p>
<p>• Reads can be grouped into logical groups e.g.&nbsp;lanes, libraries, samples</p>
<p>• Widely supported by variant calling packages and viewers</p>
<p>Since BAM is a binary format, we can’t use the standard UNIX operations directly on this file format.</p>
<p>Samtools is a set of programs for interacting with SAM and BAM files. Using the <code>samtools view</code> command, print the header of the BAM file:</p>
<p><code>samtools view -H data/NA20538.bam</code></p>
<p><strong>Q13: What version of the human assembly was used to perform the alignments? (Hint: Can you spot this somewhere in the @SQ records?)</strong></p>
<p><strong>Q14: How many lanes are in this BAM file? (Hint: Do you recall what RG represents?)</strong></p>
<p><strong>Q15: What programs were used to create this BAM file? (Hint: have a look for the program record, @PG)</strong></p>
<p><strong>Q16: What version of bwa was used to align the reads? (Hint: is there anything in the @PG record that looks like it could be a version tag?)</strong></p>
<p>The output from running samtools view on a BAM file without any options is a headerless SAM file.</p>
<p>This gets printed to STDOUT in the terminal, so we will want to pipe it to something. Let’s have a look at the first read of the BAM file:</p>
<p><code>samtools view data/NA20538.bam | head -n 1</code></p>
<p><strong>Q17: What is the name of the first read? (Hint: have a look at the alignment section if you can’t recall the different fields)</strong></p>
<p><strong>Q18: What position does the alignment of the read start at?</strong></p>
</section>
<section id="cram" class="level3">
<h3 class="anchored" data-anchor-id="cram">CRAM</h3>
<p>Even though BAM files are compressed, they are still very large. Typically they use 1.5-2 bytes for each base pair of sequencing data that they contain, and while disk capacity is ever improving, increases in disk capacity are being far outstripped by sequencing technologies.</p>
<p>BAM stores all of the data, this includes every read base, every base quality, and it uses a single conventional compression technique for all types of data. CRAM was designed for better compression of genomic data than SAM/BAM. CRAM uses three important concepts:</p>
<p>• Reference based compression</p>
<p>• Controlled loss of quality information</p>
<p>• Different compression methods to suit the type of data, e.g.&nbsp;base qualities vs.&nbsp;metadata vs.&nbsp;extra tags</p>
<p>The figure below displays how reference-based compression works. Instead of saving all the bases of all the reads, only the nucleotides that differ from the reference, and their positions, are kept.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/reference based compression1.png" class="img-fluid figure-img" width="472"></p>
<figcaption><strong>Reference based compression</strong></figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/reference based compression2.png" class="img-fluid figure-img" width="473"></p>
<figcaption><strong>Reference based compression</strong></figcaption>
</figure>
</div>
<p>In lossless (no information is lost) mode a CRAM file is 60% of the size of a BAM file, so archives and sequencing centres have moved from BAM to CRAM.</p>
<p>Since <strong>samtools 1.3</strong>, CRAM files can be read in the same way that BAM files can. We will look closer at how you can convert between SAM, BAM and CRAM formats in the next section.</p>
</section>
<section id="indexing" class="level3">
<h3 class="anchored" data-anchor-id="indexing">Indexing</h3>
<p>To allow for fast random access of regions in BAM and CRAM files, they can be indexed. The files must first be coordinate-sorted rather that sorted by read name. This can be done using <code>samtools sort</code>. If no options are supplied, it will by default sort by the left-most position of the reference.</p>
<p><code>samtools sort -o data/NA20538_sorted.bam data/NA20538.bam</code></p>
<p>Now we can use samtools index to create an index file (.bai) for our sorted BAM file:</p>
<p><code>samtools index data/NA20538_sorted.bam</code></p>
<p>To look for reads mapped to a specific region, we can use samtools view and specify the region we are interested in as: RNAME[:STARTPOS[-ENDPOS]]. For example, to look at all the reads mapped to a region called <strong>chr4</strong>, we could use:</p>
<p><code>samtools view alignment.bam chr4</code></p>
<p>To look at the region on <strong>chr4</strong> beginning at position 1,000,000 and ending at the end of the chromosome, we can do:</p>
<p><code>samtools view alignment.bam chr4:1000000</code></p>
<p>And to explore the 1001bp long region on <strong>chr4</strong> beginning at position 1,000 and ending at position</p>
<p>2,000, we can use:</p>
<p><code>samtools view alignment.bam chr4:1000-2000</code></p>
<p><strong>Q19: How many reads are mapped to region 20025000-20030000 on chromosome 1?</strong></p>
</section>
<section id="vcf" class="level3">
<h3 class="anchored" data-anchor-id="vcf">VCF</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/VCF.png" class="img-fluid figure-img" width="542"></p>
<figcaption><strong>The VCF format</strong></figcaption>
</figure>
</div>
<p>The VCF file format was introduced to store variation data. VCF consists of tab-delimited text and is parsable by standard UNIX commands which makes it flexible and user-extensible. The figure below provides an overview of the different components of a VCF file:</p>
</section>
<section id="vcf-header" class="level3">
<h3 class="anchored" data-anchor-id="vcf-header">VCF header</h3>
<p>The VCF header consists of meta-information lines (starting with ##) and a header line (starting with #). All meta-information lines are optional and can be put in any order, except for fileformat. This holds the information about which version of VCF is used and must come first.</p>
<p>The meta-information lines consist of key=value pairs. Examples of meta-information lines that can be included are ##INFO, ##FORMAT and ##reference. The values can consist of multiple fields enclosed by &lt;&gt;. More information about these fields is available in the VCF specification <a href="http://samtools.github.io/hts-specs/VCFv4.3.pdf" class="uri">http://samtools.github.io/hts-specs/VCFv4.3.pdf</a>. This can be accessed using a web browser and there is a copy in the QC directory.</p>
<p>Header line The header line starts with # and consists of 8 required fields:</p>
<p>1. <strong>CHROM</strong>: an identifier from the reference genome</p>
<p>2. <strong>POS</strong>: the reference position</p>
<p>3. <strong>ID</strong>: a list of unique identifiers (where available)</p>
<p>4. <strong>REF</strong>: the reference base(s)</p>
<p>5. <strong>ALT</strong>: the alternate base(s)</p>
<p>6. <strong>QUAL</strong>: a phred-scaled quality score</p>
<p>7. <strong>FILTER</strong>: filter status</p>
<p>8. <strong>INFO</strong>: additional information</p>
<p>If the file contains genotype data, the required fields are also followed by a FORMAT column header, and then a number of sample IDs. The FORMAT field specifies the data types and order. Some examples of these data types are:</p>
<p>• <strong>GT</strong>: Genotype, encoded as allele values separated by either / or |</p>
<p>• <strong>DP</strong>: Read depth at this position for this sample</p>
<p>• <strong>GQ</strong>: Conditional genotype quality, encoded as a phred quality</p>
</section>
<section id="body" class="level3">
<h3 class="anchored" data-anchor-id="body">Body</h3>
<p>In the body of the VCF, each row contains information about a position in the genome along with genotype information on samples for each position, all according to the fields in the header line.</p>
</section>
<section id="bcf" class="level3">
<h3 class="anchored" data-anchor-id="bcf">BCF</h3>
<p>BCF is a compressed binary representation of VCF. VCF can be compressed with BGZF (bgzip) and indexed with TBI or CSI (tabix), but even compressed</p>
<p>it can still be very big. For example, a compressed VCF with 3781 samples of human data will be 54 GB for chromosome 1, and 680 GB for the whole genome. VCFs can also be slow to parse, as text conversion is slow. The main bottleneck is the “FORMAT” fields. For this reason the BCF format was developed.</p>
<p>In BCF files the fields are rearranged for fast access. The following images show the process of converting a VCF file into a BCF file.</p>
<p><img src="images/BCF.png" class="img-fluid" width="528"></p>
<p>Bcftools comprises a set of programs for interacting with VCF and BCF files. It can be used to convert between VCF and BCF and to view or extract records from a region.</p>
</section>
<section id="bcftools-view" class="level3">
<h3 class="anchored" data-anchor-id="bcftools-view">bcftools view</h3>
<p>Let’s have a look at the header of the file 1kg.bcf in the data directory. Note that <strong>bcftools</strong> uses <strong>-h</strong> to print only the header, while <strong>samtools</strong> uses <strong>-H</strong> for this.</p>
<p><code>bcftools view -h data/1kg.bcf</code></p>
<p>Similarly to BAM, BCF supports random access, that is, fast retrieval from a given region. For this, the file must be indexed:</p>
<p><code>bcftools index data/1kg.bcf</code></p>
<p>Now we can extract all records from the region <strong>20:24042765-24043073</strong>, using the -r option. The <strong>-H</strong> option will make sure we don’t include the header in the output:</p>
<p><code>bcftools view -H -r 20:24042765-24043073 data/1kg.bcf</code></p>
</section>
<section id="bcftools-query" class="level3">
<h3 class="anchored" data-anchor-id="bcftools-query">bcftools query</h3>
<p>The versatile <code>bcftools query</code> command can be used to extract any VCF field. Combined with standard UNIX commands, this gives a powerful tool for quick querying of VCFs. Have a look at the usage options:</p>
<p><code>bcftools query -h</code></p>
<p>Let’s try out some useful options. As you can see from the usage, <strong>-l</strong> will print a list of all the samples in the file. Give this a go:</p>
<p><code>bcftools query -l data/1kg.bcf</code></p>
<p>Another very useful option is <strong>-s</strong> which allows you to extract all the data relating to a particular sample. This is a common option meaning it can be used for many bcftools commands, like <code>bcftools view</code>. Try this for sample <strong>HG00131</strong>:</p>
<p><code>bcftools view -s HG00131 data/1kg.bcf | head -n 50</code></p>
<p>The format option, <strong>-f</strong> can be used to select what gets printed from your query command. For example, the following will print the position, reference base and alternate base for sample HG00131, separated by tabs:</p>
<p><code>bcftools query -f'%POS\t%REF\t%ALT\n' -s HG00131 data/1kg.bcf | head</code></p>
<p>Finally, let’s look at the <strong>-i</strong> option. With this option we can select only sites for which a particular expression is true. For instance, if we only want to look at sites that have at least 2 alternate alleles, we can use the following expression (piped to head to only show a subset of the output):</p>
<p><code>bcftools query -f'%CHROM\t%POS\n' -i 'AC[0]&gt;2' data/1kg.bcf | head</code></p>
<p>We use <strong>-i</strong> with the expression <code>AC[0]&gt;2</code>. AC is an info field that holds the allele _count.</p>
<p>Some fields can hold multiple values, so we use <code>AC[0]&gt;2</code> to indicate that we are looking for the first value (this is zero indexed, and hence starts at 0 instead of 1), and that this value should be &gt; 2. To format our output, we use <strong>-f</strong> to specify that we want to print the chromosome name and position.</p>
<p>There is more information about expressions on the <strong>bcftools</strong> manual page <a href="http://samtools.github.io/bcftools/bcftools.html#expressions" class="uri">http://samtools.github.io/bcftools/bcftools.html#expressions</a></p>
<p>Now, try and answer the following questions about the file <strong>1kg.bcf</strong> in the data directory. For more information about the different usage options you can open the bcftools query manual page <a href="http://samtools.github.io/bcftools/bcftools.html#query" class="uri">http://samtools.github.io/bcftools/bcftools.html#query</a> in a web browser.</p>
<p><strong>Q20: What version of the human assembly do the coordinates refer to?</strong></p>
<p><strong>Q21: How many samples are there in the BCF?</strong></p>
<p><strong>Q22: What is the genotype of the sample HG00107 at the position 20:24019472? (Hint: use the combination of -r, -s, and -f options)</strong></p>
<p><strong>Q23: How many positions are there with more than 10 alternate alleles? (Hint: use the -i filtering option)</strong></p>
<p><strong>Q24: In how many positions does HG00107 have a non-reference genotype and a read depth bigger than 10? (Hint: you can use pipes to combine bcftools queries)</strong></p>
</section>
<section id="gvcf" class="level3">
<h3 class="anchored" data-anchor-id="gvcf">gVCF</h3>
<p>Often it is not enough to know variant sites only. For instance, we don’t know if a site was dropped because it matches the reference or because the data is missing. We sometimes need evidence for both variant and non-variant positions in the genome. In gVCF format, blocks of reference-only sites can be represented in a single record using the “INFO/END” tag. Symbolic alleles (&lt;*&gt;) are used for incremental calling:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/gVCF.png" class="img-fluid figure-img" width="430"></p>
<figcaption><strong>gVCF</strong></figcaption>
</figure>
</div>
<p><strong>Q25: In the above example, what is the size of the reference-only block starting at position 9923?</strong></p>
<p><strong>Q26: For the same block, what is the first base?</strong></p>
<p><strong>Q27: How many reference reads does the block have?</strong></p>
<p>Now continue to the next section of the tutorial: QC assessment of NGS data.</p>
</section>
<section id="qc-assessment-of-ngs-data" class="level3">
<h3 class="anchored" data-anchor-id="qc-assessment-of-ngs-data">QC assessment of NGS data</h3>
<p>QC is an important part of any analysis. In this section we are going to look at some of the metrics and graphs that can be used to assess the QC of NGS data.</p>
</section>
<section id="base-quality" class="level3">
<h3 class="anchored" data-anchor-id="base-quality">Base quality</h3>
<p>Illumina sequencing technology relies on sequencing by synthesis. One of the most common problems with this is dephasing. For each sequencing cycle, there is a possibility that the replication machinery slips and either incorporates more than one nucleotide or perhaps misses to incorporate one at all. The more cycles that are run (i.e.&nbsp;the longer the read length gets), the greater the accumulation of these types of errors gets. This leads to a heterogeneous population in the cluster, and a decreased signal purity, which in turn reduces the precision of the base calling. The figure below shows an example of this.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/base quality.png" class="img-fluid figure-img" width="336"></p>
<figcaption><strong>Mean base quality</strong></figcaption>
</figure>
</div>
<p>Because of dephasing, it is possible to have high-quality data at the beginning of the read but really low-quality data towards the end of the read. In those cases you can decide to trim off the low-quality reads, for example using a tool called Trimmomatic.</p>
<p>The figures below shows an example of a good sequencing run (left) and a poor sequencing run (right).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/base quality2.png" class="img-fluid figure-img" width="438"></p>
<figcaption><strong>Base quality</strong></figcaption>
</figure>
</div>
</section>
<section id="other-base-calling-errors" class="level3">
<h3 class="anchored" data-anchor-id="other-base-calling-errors">Other base calling errors</h3>
<p>There are several different reasons for a base to be called incorrectly, as shown in the figure below.</p>
<p>Phasing noise and signal decay is a result of the dephasing issue described above. During library preparation, mixed clusters can occur if multiple templates get co-located. These clusters should be removed from the downstream analysis. Boundary effects occur due to optical effects when the intensity is uneven across each tile, resulting in higher intensity found toward the center. Cross-talk occurs because the emission frequency spectra for each of the four base dyes partly overlap, creating uncertainty. Finally, for previous sequencing cycle methods T fluorophore accumulation was an issue, where incomplete removal of the dye coupled to thymine lead to an ambient accumulation the nucleotides, causing a false high Thymine trend.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/base calling errors.png" class="img-fluid figure-img" width="501"></p>
<figcaption><strong>Base calling errors</strong></figcaption>
</figure>
</div>
</section>
<section id="mismatches-per-cycle" class="level3">
<h3 class="anchored" data-anchor-id="mismatches-per-cycle">Mismatches per cycle</h3>
<p>Aligning reads to a high-quality reference genome can provide insight to the quality of a sequencing run by showing you the mismatches to the reference sequence. This can help you detect cycle-specific errors. Mismatches can occur due to two main causes, sequencing errors and differences between your sample and the reference genome, which is important to bear in mind when interpreting mismatch graphs. The figure below shows an example of a good run (left) and a bad one (right). In the graph on the left, the distribution of the number of mismatches is even between the cycles, which is what we would expect from a good run. However, in the graph on the right, two cycles stand out with a lot of mismatches compared to the other cycles.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/missmatches per cycle.png" class="img-fluid figure-img" width="536"></p>
<figcaption>Missmatches per cycle</figcaption>
</figure>
</div>
<section id="gc-content" class="level4">
<h4 class="anchored" data-anchor-id="gc-content">GC content</h4>
<p>It is a good idea to compare the GC content of the reads against the expected distribution in a reference sequence. The GC content varies between species, so a shift in GC content like the one seen below could be an indication of sample contamination. In the left graph below, we can see that the GC content of the sample is about the same as for the reference, at ~38%. However, in the right graph, the GC content of the sample is closer to 55%, indicating that there is an issue with this sample.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/gc content.png" class="img-fluid figure-img" width="497"></p>
<figcaption><strong>GC content</strong></figcaption>
</figure>
</div>
</section>
</section>
<section id="gc-content-by-cycle" class="level3">
<h3 class="anchored" data-anchor-id="gc-content-by-cycle">GC content by cycle</h3>
<p>Looking at the GC content per cycle can help detect if the adapter sequence was trimmed. For a random library, it is expected to be little to no difference between the different bases of a sequence run, so the lines in this plot should be parallel with each other like in the graph on the left below.</p>
<p>In the graph on the right, the initial spikes are likely due to adapter sequences that have not been removed.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/GC content by cycle.png" class="img-fluid figure-img" width="542"></p>
<figcaption><strong>GC content by cycle</strong></figcaption>
</figure>
</div>
</section>
<section id="fragment-size" class="level3">
<h3 class="anchored" data-anchor-id="fragment-size">Fragment size</h3>
<p>For paired-end sequencing the size of DNA fragments also matters. In the first of the examples below, the fragment size peaks around 440 bp. In the second however, there is also a peak at around 200 bp. This indicates that there was an issue with the fragment size selection during library prep.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/fragment size distribution.png" class="img-fluid figure-img"></p>
<figcaption><strong>Fragment size distribution</strong></figcaption>
</figure>
</div>
<p><strong>Q1: The figure below is from a 100bp paired-end sequencing. Can you spot any problems?</strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/insert size.png" class="img-fluid figure-img" width="490"></p>
<figcaption><strong>Insert size</strong></figcaption>
</figure>
</div>
</section>
<section id="insertionsdeletions-per-cycle" class="level3">
<h3 class="anchored" data-anchor-id="insertionsdeletions-per-cycle">Insertions/Deletions per cycle</h3>
<p>Sometimes, air bubbles occur in the flow cell, which can manifest as false indels. The spike in the right image provides an example of how this can look.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/indels per cycle.png" class="img-fluid figure-img" width="415"></p>
<figcaption><strong>Indels per cycle</strong></figcaption>
</figure>
</div>
</section>
<section id="generating-qc-stats" class="level3">
<h3 class="anchored" data-anchor-id="generating-qc-stats">Generating QC stats</h3>
<p>Now let’s try this out! We will generate QC stats for two lanes of Illumina paired-end sequencing data from yeast. The reads have already been aligned to the <em>Saccromyces cerevisiae</em> reference genome to produce the BAM file <em>lane1.sorted.bam</em>.</p>
<p>Now we will use samtools stats to generate the stats for the primary alignments. The option <strong>-f</strong> can be used to filter reads with specific tags, while <strong>-F</strong> can be used to filter out reads with specific tags. The following command will include only primary alignments:</p>
<p><code>samtools stats -F SECONDARY data/lane1.sorted.bam &gt; data/lane1.sorted.bam.bchk</code></p>
<p>Have a look at the first 47 lines of the statistics file that was generated:</p>
<p><code>head -n 47 data/lane1.sorted.bam.bchk</code></p>
<p>This file contains a number of useful stats that we can use to get a better picture of our data, and it can even be plotted with plot-bamstats, as you will see soon. First let’s have a closer look at some of the different stats. Each part of the file starts with a # followed by a description of the section and how to extract it from the file. Let’s have a look at all the sections in the file:</p>
<p><code>grep ^'#' data/lane1.sorted.bam.bchk | grep 'Use'</code></p>
</section>
<section id="summary-numbers-sn" class="level3">
<h3 class="anchored" data-anchor-id="summary-numbers-sn">Summary Numbers (SN)</h3>
<p>This initial section contains a summary of the alignment and includes some general statistics. In particular, you can see how many bases mapped, and how much of the genome that was covered.</p>
<p>Now look at the output and try to answer the questions below.</p>
<p><strong>Q2: What is the total number of reads?</strong></p>
<p><strong>Q3: What proportion of the reads were mapped?</strong></p>
<p><strong>Q4: How many pairs were mapped to a different chromosome?</strong></p>
<p><strong>Q5: What is the insert size mean and standard deviation?</strong></p>
<p><strong>Q6: How many reads were paired properly?</strong></p>
</section>
<section id="generating-qc-plots" class="level3">
<h3 class="anchored" data-anchor-id="generating-qc-plots">Generating QC plots</h3>
<p>Finally, we will create some QC plots from the output of the stats command using the command plot-bamstats which is included in the samtools package:</p>
<p><code>plot-bamstats -p data/lane1-plots/ data/lane1.sorted.bam.bchk</code></p>
<p>Now in your web browser open the file lane1-plots/index.html to view the QC information.</p>
<p><strong>Q7: How many reads have zero mapping quality?</strong></p>
<p><strong>Q8: Which read (forward/reverse) of the first fragments and second fragments are higher base quality on average?</strong></p>
<p>Now continue to the next section of the tutorial: File conversion.</p>
</section>
</section>
<section id="file-conversion" class="level2">
<h2 class="anchored" data-anchor-id="file-conversion">File conversion</h2>
<p>In this section we are going to look at how to convert from one file format to another. There are many tools available for converting between file formats, and we will use some of the most common ones: <strong>samtools, bcftools</strong> and <strong>Picard</strong>.</p>
<section id="sam-to-bam" class="level3">
<h3 class="anchored" data-anchor-id="sam-to-bam">SAM to BAM</h3>
<p>To convert from SAM to BAM format we are going to use the samtools view command. In this instance, we would like to include the SAM header, so we use the -h option:</p>
<p><code>samtools view -h data/NA20538.bam &gt; data/NA20538.sam</code></p>
<p>Now, have a look at the first ten lines of the SAM file. They should look like they did in the previous section when you viewed the BAM file header.</p>
<p><code>head data/NA20538.sam</code></p>
<p>Well that was easy! And converting SAM to BAM is just as straightforward. This time there is no need for the <strong>-h</strong> option, however we have to tell <strong>samtools</strong> that we want the output in BAM format.</p>
<p>We do so by adding the <strong>-b</strong> option:</p>
<p><code>samtools view -b data/NA20538.sam &gt; data/NA20538_2.bam</code></p>
<p>Samtools is very well documented, so for more usage options and functions, have a look at the samtools manual <a href="http://www.htslib.org/doc/samtools-1.0.html" class="uri">http://www.htslib.org/doc/samtools-1.0.html</a>.</p>
</section>
<section id="bam-to-cram" class="level3">
<h3 class="anchored" data-anchor-id="bam-to-cram">BAM to CRAM</h3>
<p>The <code>samtools view</code> command can be used to convert a BAM file to CRAM format. In the data directory there is a BAM file called yeast.bam that was created from <em>S. cerevisiae</em> Illumina sequencing data. There is also a reference genome in the directory, called <em>Saccharomyces_cerevisiae.EF4.68.dna.toplevel.fa</em>. For the conversion, an index file (.fai) for the reference must be created. This can be done using <code>samtools faidx</code>. However, as we will see, <strong>samtools</strong> will generate this file on the fly when we specify a reference file using the <strong>-F</strong> option.</p>
<p>To convert to CRAM, we use the <strong>-C</strong> option to tell samtools we want the output as CRAM, and the <strong>-T</strong> option to specify what reference file to use for the conversion. We also use the <strong>-o</strong> option to specify the name of the output file. Give this a try:</p>
<p><code>samtools view -C -T data/Saccharomyces_cerevisiae.EF4.68.dna.toplevel.fa -o data/yeast.cram data/yeast.bam</code></p>
<p>Have a look at what files were created:</p>
<p><code>ls -l data</code></p>
<p>As you can see, this has created an index file for the reference genome called <code>Saccharomyces_cerevisiae.EF4.68.dna.toplevel.fa.fai</code> and the CRAM file <strong>yeast.cram</strong>.</p>
<p><strong>Q1: Since CRAM files use reference-based compression, we expect the CRAM file to be smaller than the BAM file. What is the size of the CRAM file?</strong></p>
<p><strong>Q2: Is your CRAM file smaller than the original BAM file?</strong></p>
<p>To convert CRAM back to BAM, simply change <strong>-C</strong> to <strong>-b</strong> and change places for the input and output CRAM/BAM:</p>
<p><code>samtools view -b -T data/Saccharomyces_cerevisiae.EF4.68.dna.toplevel.fa -o data/yeast.bam data/yeast.cram</code></p>
</section>
<section id="fastq-to-sam" class="level3">
<h3 class="anchored" data-anchor-id="fastq-to-sam">FASTQ to SAM</h3>
<p>SAM format is mainly used to store alignment data, however in some cases we may want to store</p>
<p>the unaligned data in SAM format and for this we can use the <strong>picard tools FastqToSam</strong> application.</p>
<p><strong>Picard tools</strong> is a Java application that comes with a number of useful options for manipulating high-throughput sequencing data. .</p>
<p>To convert the FASTQ files of lane 13681_1#18 to unaligned SAM format, run:</p>
<p><code>picard FastqToSam F1=data/13681_1#18_1.fastq.gz F2=data/13681_1#18_2.fastq.gz O=data/13681_1#18.sam SM=13681_1#18</code></p>
<p>From here you can go on and convert the SAM file to BAM and CRAM, as described previously.</p>
<p>There are also multiple options for specifying what metadata to include in the SAM header. To see all available options, run:</p>
<p><code>picard FastqToSam -h</code></p>
</section>
<section id="cram-to-fastq" class="level3">
<h3 class="anchored" data-anchor-id="cram-to-fastq">CRAM to FASTQ</h3>
<p>It is possible to convert CRAM to FASTQ directly using the <code>samtools fastq</code> command. However, for many applications we need the fastq files to be ordered so that the order of the reads in the first file match the order of the reads in the mate file. For this reason, we first use samtools collate to produce a collated BAM file.</p>
<p><code>samtools collate data/yeast.cram data/yeast.collated</code></p>
<p>The newly produced BAM file will be called yeast.collated.bam. Let’s use this to create two FASTQ files, one for the forward reads and one for the reverse reads:</p>
<p><code>samtools fastq -1 data/yeast.collated_1.fastq -2 data/yeast.collated_2.fastq data/yeast.collated.bam</code></p>
<p>For further information and usage options, have a look at the samtools manual page (<a href="http://www.htslib.org/doc/samtools.html" class="uri">http://www.htslib.org/doc/samtools.html</a>).</p>
</section>
<section id="vcf-to-bcf" class="level3">
<h3 class="anchored" data-anchor-id="vcf-to-bcf">VCF to BCF</h3>
<p>In a similar way that <strong>samtools view</strong> can be used to convert between SAM, BAM and CRAM, <strong>bcftools view</strong> can be used to convert between VCF and BCF. To convert the file called 1kg.bcf to a compressed VCF file called <em>1kg.vcf.gz</em>, run:</p>
<p><code>bcftools view -O z -o data/1kg.vcf.gz data/1kg.bcf</code></p>
<p>The <strong>-O</strong> option allows us to specify in what format we want the output, compressed BCF (b), uncompressed BCF (u), compressed VCF (z) or uncompressed VCF (v). With the -o option we can select the name of the output file.</p>
<p>Have a look at what files were generated (the options <strong>-lrt</strong> will list the files in reverse chronological order):</p>
<p><code>ls -lrt data</code></p>
<p>This also generated an index file, <code>1kg.bcf.csi</code>.</p>
<p>To convert a VCF file to BCF, we can run a similar command. If we want to keep the original BCF, we need to give the new one a different name so that the old one is not overwritten:</p>
<p><code>bcftools view -O b -o data/1kg_2.bcf data/1kg.vcf.gz</code></p>
<p>Congratulations you have reached the end of the Data formats and QC tutorial!</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../course_modules/Module1/module1_manual.html" class="pagination-link" aria-label="Manual">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Manual</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../course_modules/Module2/module2_manual.html" class="pagination-link" aria-label="Manual">
        <span class="nav-page-text">Manual</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>This work is licensed under a Creative Commons Attribution 4.0 International License. Reuse is encouraged with acknowledgement</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Manual – NGS Bioinformatics course</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">NGS Bioinformatics course</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-modules" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Modules</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-modules">    
        <li>
    <a class="dropdown-item" href="../../course_modules/Module1/module1.html">
 <span class="dropdown-text">File formats</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course_modules/Module2/module2.html">
 <span class="dropdown-text">Reads alignment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course_modules/Module3/module3.html">
 <span class="dropdown-text">Variant calling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course_modules/Module4/module4.html">
 <span class="dropdown-text">Structural Variation Calling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course_modules/Module5/module5.html">
 <span class="dropdown-text">Genome assembly</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course_modules/Module6/module6.html">
 <span class="dropdown-text">RNA-seq</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course_modules/Module7/module7.html">
 <span class="dropdown-text">CHiP-Seq</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sequence-data-formats" id="toc-sequence-data-formats" class="nav-link active" data-scroll-target="#sequence-data-formats"><strong>1. Sequence Data Formats</strong></a>
  <ul class="collapse">
  <li><a href="#the-fasta-file-format" id="toc-the-fasta-file-format" class="nav-link" data-scroll-target="#the-fasta-file-format">The FASTA file format</a></li>
  <li><a href="#the-fastq-file-format" id="toc-the-fastq-file-format" class="nav-link" data-scroll-target="#the-fastq-file-format"><strong>The FASTQ file format</strong></a></li>
  </ul></li>
  <li><a href="#alignment-and-mapping-formats" id="toc-alignment-and-mapping-formats" class="nav-link" data-scroll-target="#alignment-and-mapping-formats"><strong>2. Alignment and Mapping Formats</strong></a>
  <ul class="collapse">
  <li><a href="#structure-of-the-flag" id="toc-structure-of-the-flag" class="nav-link" data-scroll-target="#structure-of-the-flag"><strong>Structure of the Flag</strong></a></li>
  <li><a href="#how-to-interpret-a-sam-file-flag" id="toc-how-to-interpret-a-sam-file-flag" class="nav-link" data-scroll-target="#how-to-interpret-a-sam-file-flag"><strong>How to interpret a SAM file flag</strong></a></li>
  <li><a href="#the-bam-file-format" id="toc-the-bam-file-format" class="nav-link" data-scroll-target="#the-bam-file-format">The BAM file format</a></li>
  <li><a href="#key-features-of-the-bam-format" id="toc-key-features-of-the-bam-format" class="nav-link" data-scroll-target="#key-features-of-the-bam-format"><strong>Key Features of the BAM Format</strong></a></li>
  <li><a href="#sambam-tools" id="toc-sambam-tools" class="nav-link" data-scroll-target="#sambam-tools"><strong>SAM/BAM Tools</strong></a></li>
  <li><a href="#reference-based-compression" id="toc-reference-based-compression" class="nav-link" data-scroll-target="#reference-based-compression">Reference-Based Compression</a></li>
  <li><a href="#limitations-of-bam-compression" id="toc-limitations-of-bam-compression" class="nav-link" data-scroll-target="#limitations-of-bam-compression"><strong>Limitations of BAM Compression</strong></a></li>
  <li><a href="#the-case-for-reference-based-compression" id="toc-the-case-for-reference-based-compression" class="nav-link" data-scroll-target="#the-case-for-reference-based-compression"><strong>The Case for Reference-Based Compression</strong></a></li>
  <li><a href="#benefits-of-reference-based-compression" id="toc-benefits-of-reference-based-compression" class="nav-link" data-scroll-target="#benefits-of-reference-based-compression"><strong>Benefits of Reference-Based Compression</strong></a></li>
  <li><a href="#looking-ahead" id="toc-looking-ahead" class="nav-link" data-scroll-target="#looking-ahead"><strong>Looking Ahead</strong></a></li>
  <li><a href="#the-cram-file-format" id="toc-the-cram-file-format" class="nav-link" data-scroll-target="#the-cram-file-format">The CRAM file format</a></li>
  <li><a href="#key-features-of-cram" id="toc-key-features-of-cram" class="nav-link" data-scroll-target="#key-features-of-cram"><strong>Key Features of CRAM</strong></a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  </ul></li>
  <li><a href="#variant-calling-formats" id="toc-variant-calling-formats" class="nav-link" data-scroll-target="#variant-calling-formats"><strong>3. Variant Calling Formats</strong></a>
  <ul class="collapse">
  <li><a href="#variant-call-format-vcf-summary" id="toc-variant-call-format-vcf-summary" class="nav-link" data-scroll-target="#variant-call-format-vcf-summary">Variant Call Format (VCF) Summary</a></li>
  <li><a href="#key-features" id="toc-key-features" class="nav-link" data-scroll-target="#key-features">Key Features</a></li>
  <li><a href="#genotype-representation" id="toc-genotype-representation" class="nav-link" data-scroll-target="#genotype-representation">Genotype Representation</a></li>
  <li><a href="#role-in-genomic-analysis" id="toc-role-in-genomic-analysis" class="nav-link" data-scroll-target="#role-in-genomic-analysis">Role in Genomic Analysis</a></li>
  <li><a href="#tumor-specific-annotations-in-vcf" id="toc-tumor-specific-annotations-in-vcf" class="nav-link" data-scroll-target="#tumor-specific-annotations-in-vcf">Tumor-Specific Annotations in VCF</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"></a></li>
  <li><a href="#example-vcf-file" id="toc-example-vcf-file" class="nav-link" data-scroll-target="#example-vcf-file"><strong>Example VCF File</strong></a></li>
  <li><a href="#explanation-of-each-column" id="toc-explanation-of-each-column" class="nav-link" data-scroll-target="#explanation-of-each-column"><strong>Explanation of Each Column</strong></a></li>
  <li><a href="#other-important-information" id="toc-other-important-information" class="nav-link" data-scroll-target="#other-important-information"><strong>Other important information</strong></a>
  <ul class="collapse">
  <li><a href="#structure-of-a-cigar-string" id="toc-structure-of-a-cigar-string" class="nav-link" data-scroll-target="#structure-of-a-cigar-string"><strong>Structure of a CIGAR String</strong></a></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways">** Key Takeaways:**</a></li>
  <li><a href="#the-maf-file-format" id="toc-the-maf-file-format" class="nav-link" data-scroll-target="#the-maf-file-format"><strong>The MAF file format</strong></a></li>
  </ul></li>
  <li><a href="#ga4gh" id="toc-ga4gh" class="nav-link" data-scroll-target="#ga4gh"><u>GA4GH</u></a>
  <ul class="collapse">
  <li><a href="#working-groups" id="toc-working-groups" class="nav-link" data-scroll-target="#working-groups"><strong>Working Groups</strong></a></li>
  <li><a href="#key-projects-of-the-data-working-group" id="toc-key-projects-of-the-data-working-group" class="nav-link" data-scroll-target="#key-projects-of-the-data-working-group"><strong>Key Projects of the Data Working Group</strong></a></li>
  <li><a href="#file-format-standards" id="toc-file-format-standards" class="nav-link" data-scroll-target="#file-format-standards"><strong>File Format Standards</strong></a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Manual</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="sequence-data-formats" class="level1">
<h1><strong>1. Sequence Data Formats</strong></h1>
<p>These formats store raw or processed nucleotide and protein sequences.&nbsp;</p>
<section id="the-fasta-file-format" class="level3">
<h3 class="anchored" data-anchor-id="the-fasta-file-format">The FASTA file format</h3>
<p>Here’s an example of 4 lines from a human reference genome FASTA file:</p>
<p><img src="images/FASTA.png" class="img-fluid"></p>
<p><code>"&gt;chr1"</code> is the header for chromosome 1. Each chromosome has its own header line in the file.&nbsp;<br>
Headers usually contain additional details like source, version, or length, e.g.:</p>
<p><code>&gt;chr1 dna:chromosome chromosome:GRCh38:1:1:248956422:1.</code></p>
<p>The following lines are the “sequence lines”.</p>
<p>They contain nucleotide bases (<code>A</code>, <code>T</code>, <code>C</code>, <code>G</code>, and sometimes <code>N</code> for unknown bases). In FASTA files, the sequence is often wrapped to fit within 80 characters per line.</p>
</section>
<section id="the-fastq-file-format" class="level3">
<h3 class="anchored" data-anchor-id="the-fastq-file-format"><strong>The FASTQ file format</strong></h3>
<p>FASTQ is a simple format for raw unaligned sequencing reads. This is an extension to the FASTA file format and it is composed of sequence and an associated per base quality score.<br>
</p>
<p><img src="images/FASTQ.png" class="img-fluid"></p>
<p>The quality of the sequenced nucleotides is encoded in ASCII characters with decimal codes <strong>33-126</strong>.</p>
<p><img src="images/fastq2.png" class="img-fluid" width="617"></p>
<p>The ASCII code of “A” is <strong>65</strong>. For a nucleotide that has the quality score encoded by A, this can be translates to&nbsp;quality score of&nbsp;<strong>Q=65<em>−</em>33=32.</strong></p>
<p>The formula to compute the phred quality score is:&nbsp;<em>P</em> = 10<sup><em>−Q/</em>10</sup></p>
<p><img src="images/phred.png" class="img-fluid" width="380"></p>
<p>The figure above shows the interpretation of the quality scores, in terms of probability of error and accuracy.</p>
<p>Beware:</p>
<ul>
<li><p>multiple quality scores were in use: Sanger, Solexa, Illumina 1.3+.</p></li>
<li><p>paired-end sequencing produces two FASTQ files.</p></li>
</ul>
<p><img src="images/ASCII.png" class="img-fluid" width="600"></p>
<p>The <strong>ASCII table</strong> (American Standard Code for Information Interchange) is a character encoding standard that maps <strong>128 characters</strong> (0–127) to numeric codes. It includes letters (uppercase and lowercase), digits, punctuation marks, control characters (e.g., newline, tab), and special symbols, enabling computers to represent and process text.<br>
</p>
</section>
</section>
<section id="alignment-and-mapping-formats" class="level1">
<h1><strong>2. Alignment and Mapping Formats</strong></h1>
<p>These formats store sequence alignments against a reference genome.</p>
<p><strong>The SAM file formats</strong></p>
<p><img src="images/SAM.png" class="img-fluid" width="600"></p>
<p>A <strong>SAM (Sequence Alignment/Map)</strong> file is a text-based format for storing biological sequences aligned to a reference genome. It consists of a <strong>header section</strong> (starting with <code>@</code>) and an <strong>alignment section</strong> (one line per read). Here’s an example of the first 10 lines from a typical SAM file aligned to the human reference genome:</p>
<p><strong>Header Lines (<code>@</code>):</strong></p>
<p><code>@HD</code>: Specifies the version and sorting order.</p>
<p><code>@SQ</code>: Lists the reference sequences (e.g., <code>chr1</code>, <code>chr2</code>) with their lengths.</p>
<p><code>@PG</code>: Records the alignment program used.</p>
<p><strong>Alignment Lines (non-<code>@</code>) fields</strong>:</p>
<p>Column 1: Query name (<code>read001</code>, <code>read002</code>, etc.).</p>
<p>Column 2: Flag (alignment information, e.g., strand orientation).</p>
<p>Column 3: Reference name (e.g., <code>chr1</code>, <code>chr2</code>).</p>
<p>Column 4: Alignment position.</p>
<p>Column 5: Mapping quality.</p>
<p>Column 6: CIGAR string (alignment operations).</p>
<p>Column 7-9: Mate pair information (if applicable).</p>
<p>Column 10: Sequence of the read.</p>
<p>Column 11: Quality scores.</p>
<p>Note that BAM can contain</p>
<p>• unmapped reads<br>
• multiple alignments of the same read<br>
• supplementary (chimeric) reads</p>
<p>In a SAM file, the <strong>Flag</strong> column (usually the second column in an alignment line) is an integer value that encodes various information about a read’s alignment using a bitwise representation. Each bit in the flag represents a specific property of the alignment, and the <strong>hexadecimal (Hex)</strong>, <strong>decimal (Dec)</strong>, and <strong>binary</strong> representations can be used to interpret these flags.</p>
<p>Here’s a detailed explanation:</p>
<section id="structure-of-the-flag" class="level3">
<h3 class="anchored" data-anchor-id="structure-of-the-flag"><strong>Structure of the Flag</strong></h3>
<p>The flag is an <strong>integer value</strong> whose binary representation consists of 12 bits, each indicating a specific property of the read. Here’s the breakdown:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Bit</strong></th>
<th><strong>Hex</strong></th>
<th><strong>Dec</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0x1</td>
<td>1</td>
<td>The read is paired in sequencing.</td>
</tr>
<tr class="even">
<td>1</td>
<td>0x2</td>
<td>2</td>
<td>The read is mapped in a proper pair.</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0x4</td>
<td>4</td>
<td>The read is unmapped.</td>
</tr>
<tr class="even">
<td>3</td>
<td>0x8</td>
<td>8</td>
<td>The mate is unmapped.</td>
</tr>
<tr class="odd">
<td>4</td>
<td>0x10</td>
<td>16</td>
<td>The read is on the reverse strand.</td>
</tr>
<tr class="even">
<td>5</td>
<td>0x20</td>
<td>32</td>
<td>The mate is on the reverse strand.</td>
</tr>
<tr class="odd">
<td>6</td>
<td>0x40</td>
<td>64</td>
<td>The read is the first in a pair.</td>
</tr>
<tr class="even">
<td>7</td>
<td>0x80</td>
<td>128</td>
<td>The read is the second in a pair.</td>
</tr>
<tr class="odd">
<td>8</td>
<td>0x100</td>
<td>256</td>
<td>The alignment is not primary.</td>
</tr>
<tr class="even">
<td>9</td>
<td>0x200</td>
<td>512</td>
<td>The read fails quality control checks.</td>
</tr>
<tr class="odd">
<td>10</td>
<td>0x400</td>
<td>1024</td>
<td>The read is a PCR or optical duplicate.</td>
</tr>
<tr class="even">
<td>11</td>
<td>0x800</td>
<td>2048</td>
<td>The read is supplementary (e.g., split-read).</td>
</tr>
</tbody>
</table>
<p>The flag is the sum of all applicable properties. For example:</p>
<p><strong>For a flag with value 83 (a written in decimal), the binary is</strong> 000000<strong>1</strong>0<strong>1</strong>00<strong>11.</strong></p>
<p>To decode the bits with value <strong>1</strong>, start from right to left:</p>
<ul>
<li><p><strong>1 (0x1)</strong>: On position <strong>0</strong> from right to left, the bit value is <strong>1</strong>. This means that the read is paired.</p></li>
<li><p><strong>2 (0x2)</strong>: On position <strong>1</strong> from right to left, the bit value is <strong>1</strong>. This means that the read is mapped in a proper pair.</p></li>
<li><p><strong>16 (0x10)</strong>: On position <strong>4</strong> from right to left, the bit value is <strong>1</strong>. This means that the read is on the reverse strand.</p></li>
<li><p><strong>64 (0x40)</strong>: On position <strong>6</strong> from right to left, the bit value is <strong>1</strong>. This means that the read is the first read in a pair.</p></li>
</ul>
<p>Overall interpretation of a flag with value 83: this is the first read in a properly paired alignment, and it is mapped to the reverse strand.</p>
</section>
<section id="how-to-interpret-a-sam-file-flag" class="level3">
<h3 class="anchored" data-anchor-id="how-to-interpret-a-sam-file-flag"><strong>How to interpret a SAM file flag</strong></h3>
<ol type="1">
<li><p>Take the decimal value in the second column.</p></li>
<li><p>Convert it to binary (or refer to the above table).</p></li>
<li><p>Decode each bit to determine the alignment properties.</p></li>
</ol>
</section>
<section id="the-bam-file-format" class="level3">
<h3 class="anchored" data-anchor-id="the-bam-file-format">The BAM file format</h3>
<p>The <strong>BAM (Binary Alignment/Map)</strong> format is a binary, compressed version of the widely-used <strong>SAM (Sequence Alignment/Map)</strong> format. It was specifically developed to enable fast processing, efficient storage, and random access to large-scale genomic data. Utilizing <strong>BGZF (Block GZIP)</strong> compression, BAM files support indexing, making them highly efficient for quick retrieval and visualization of specific alignments.</p>
</section>
<section id="key-features-of-the-bam-format" class="level3">
<h3 class="anchored" data-anchor-id="key-features-of-the-bam-format"><strong>Key Features of the BAM Format</strong></h3>
<ul>
<li><p><strong>Universal Compatibility</strong>: BAM can store alignments from a variety of mapping tools and sequencing technologies, making it a versatile format for genomic data analysis.</p></li>
<li><p><strong>Compact Size</strong>: BAM files are designed to save disk space without compromising data integrity. For example, 112 billion base pairs (Gbp) of Illumina sequencing data require just 116GB of storage in BAM format.</p></li>
<li><p><strong>Indexing Support</strong>: BAM files can be indexed, allowing for the rapid retrieval and visualization of specific regions of interest in the genome.</p></li>
<li><p><strong>Logical Grouping</strong>: Reads can be organized into logical groups such as lanes, libraries, and samples, providing flexibility for downstream analyses.</p></li>
<li><p><strong>Integration with Variant Calling</strong>: BAM files are widely supported by tools for variant calling and other bioinformatics workflows.</p></li>
<li><p><strong>Visualization Compatibility</strong>: BAM files are compatible with popular genome browsers and visualization tools, including</p>
<ul>
<li><p><strong>IGV</strong></p></li>
<li><p><strong>Ensembl</strong>, and</p></li>
<li><p><strong>UCSC Genome Browser</strong>.</p></li>
</ul></li>
</ul>
</section>
<section id="sambam-tools" class="level3">
<h3 class="anchored" data-anchor-id="sambam-tools"><strong>SAM/BAM Tools</strong></h3>
<p>Several tools have been developed for interacting with SAM and BAM files:</p>
<ul>
<li><p><a href="https://www.htslib.org/"><u><strong>Samtools</strong></u></a><u>:</u> A comprehensive toolkit developed by the Wellcome Sanger Institute for manipulating SAM and BAM files.</p></li>
<li><p><a href="https://broadinstitute.github.io/picard/"><u><strong>Picard Tools</strong></u></a>: Developed by the Broad Institute, this suite provides utilities for processing and analyzing BAM files.</p></li>
<li><p><u><strong>Visualization Tools</strong></u>:</p>
<ul>
<li><p>Genome browsers such as IGV (Integrative Genomics Viewer),</p></li>
<li><p>Ensembl, and</p></li>
<li><p>UCSC Genome Browser allow users to explore BAM files interactively.</p></li>
</ul></li>
</ul>
<p>The BAM format is an essential component of modern genomic workflows, offering an efficient, versatile, and widely-supported solution for storing and analyzing alignment data.</p>
</section>
<section id="reference-based-compression" class="level3">
<h3 class="anchored" data-anchor-id="reference-based-compression">Reference-Based Compression</h3>
<p>As sequencing technologies continue to advance, the volume of genomic data generated has increased exponentially, creating a growing challenge for data storage and management. While BAM files are efficient compared to uncompressed formats, they remain relatively large, requiring approximately&nbsp;<strong>1.5–2 bytes per base pair</strong>. This size makes BAM files increasingly difficult to handle as disk capacity improvements fail to keep pace with the rapid growth in sequencing throughput.</p>
</section>
<section id="limitations-of-bam-compression" class="level3">
<h3 class="anchored" data-anchor-id="limitations-of-bam-compression"><strong>Limitations of BAM Compression</strong></h3>
<p>BAM files employ a single conventional compression technique (<strong>BGZF compression</strong>) to store various types of data, including:</p>
<ul>
<li><p><strong>Read bases</strong>: Every nucleotide in the sequencing read is stored in the file.</p></li>
<li><p><strong>Base qualities</strong>: Quality scores for each base are preserved, often contributing significantly to the file size.</p></li>
</ul>
<p>While effective, this approach compresses all data types uniformly, which limits opportunities for optimizing compression specific to genomic contexts.</p>
</section>
<section id="the-case-for-reference-based-compression" class="level3">
<h3 class="anchored" data-anchor-id="the-case-for-reference-based-compression"><strong>The Case for Reference-Based Compression</strong></h3>
<p>Reference-based compression addresses these limitations by leveraging the known reference genome to reduce redundancy in storage. Instead of storing the full sequence and quality scores for every read:</p>
<ol type="1">
<li><p><strong>Alignment Information</strong>: Only deviations or differences from the reference genome (e.g., mismatches, insertions, deletions) are stored.</p></li>
<li><p><strong>Simplified Data Representation</strong>: Reads that match the reference genome perfectly require minimal data storage.</p></li>
<li><p><strong>Selective Compression</strong>: Different data types (e.g., quality scores, sequence alignments) can be compressed differently, optimizing file sizes further.</p>
<p><img src="images/reference based compression1.png" class="img-fluid" width="400"></p>
<p><img src="images/reference based compression2.png" class="img-fluid" width="400"></p></li>
</ol>
</section>
<section id="benefits-of-reference-based-compression" class="level3">
<h3 class="anchored" data-anchor-id="benefits-of-reference-based-compression"><strong>Benefits of Reference-Based Compression</strong></h3>
<ul>
<li><p><strong>Drastic Reduction in File Size</strong>: By only storing differences from the reference genome, file sizes can be reduced significantly compared to BAM files.</p></li>
<li><p><strong>Efficient Data Retrieval</strong>: Reference-based compressed files can still support random access, enabling efficient querying of specific genomic regions.</p></li>
<li><p><strong>Scalability</strong>: Smaller files make it easier to store and transfer the growing amounts of sequencing data generated by high-throughput technologies.</p></li>
</ul>
</section>
<section id="looking-ahead" class="level3">
<h3 class="anchored" data-anchor-id="looking-ahead"><strong>Looking Ahead</strong></h3>
<p>While BAM files have been a cornerstone of genomic data storage, reference-based compression offers a promising alternative to address the challenges of handling ever-larger datasets. By focusing on reducing redundancy and optimising compression techniques, reference-based approaches can ensure that storage solutions keep pace with advancements in sequencing technology.</p>
</section>
<section id="the-cram-file-format" class="level3">
<h3 class="anchored" data-anchor-id="the-cram-file-format">The CRAM file format</h3>
<p><strong>CRAM</strong> is a highly efficient file format for storing aligned sequencing data, offering significant compression improvements over BAM by incorporating three key concepts:</p>
<ol type="1">
<li><p><strong>Reference-Based Compression</strong>: Instead of storing full sequences, CRAM files record differences from a reference genome, reducing redundancy and file size.</p></li>
<li><p><strong>Controlled Loss of Quality Information</strong>: Users can opt for lossy compression by discarding or simplifying base quality scores, further minimizing storage requirements without heavily impacting downstream analyses.</p></li>
<li><p><strong>Optimized Compression</strong>: Different types of data (e.g., base qualities, metadata, and extra tags) are compressed using tailored methods for maximum efficiency.</p></li>
</ol>
</section>
<section id="key-features-of-cram" class="level3">
<h3 class="anchored" data-anchor-id="key-features-of-cram"><strong>Key Features of CRAM</strong></h3>
<ul>
<li><p><strong>Smaller File Sizes</strong>: CRAM files are approximately&nbsp;<strong>60% the size of BAM files</strong>&nbsp;in lossless mode, with further reductions possible in lossy mode.</p></li>
<li><p><strong>Maturity and Adoption</strong>: CRAM is well-integrated into production pipelines, with:</p>
<ul>
<li>Support in <strong>Samtools/HTSlib</strong> since 2014.</li>
</ul></li>
<li><p>Integration with <strong>Picard</strong> and <strong>GATK</strong> in 2015.</p>
<p>CRAM’s efficient compression and flexibility make it a powerful alternative to BAM, especially for large-scale sequencing projects.</p></li>
</ul>
<p><img src="images/CRAM.png" class="img-fluid" width="427"></p>
</section>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section"></h3>
</section>
</section>
<section id="variant-calling-formats" class="level1">
<h1><strong>3. Variant Calling Formats</strong></h1>
<p>These formats store genetic variations detected in sequencing data.</p>
<section id="variant-call-format-vcf-summary" class="level3">
<h3 class="anchored" data-anchor-id="variant-call-format-vcf-summary">Variant Call Format (VCF) Summary</h3>
<p>The <strong>Variant Call Format (VCF)</strong> is a widely-used, standardized file format for storing genetic variation data. Designed to handle diverse types of genomic variations, including <strong>SNPs</strong>, <strong>indels</strong>, and <strong>structural variations</strong>, VCF is integral to genomic workflows and supports the analysis of datasets involving multiple samples.</p>
</section>
<section id="key-features" class="level3">
<h3 class="anchored" data-anchor-id="key-features">Key Features</h3>
<p>VCF is a tab-delimited text file format that efficiently captures and organizes genomic variations. It supports all types of variants, from single nucleotide polymorphisms (SNPs) to large structural changes. With its flexibility and extensibility, VCF accommodates per-site and per-sample annotations, enabling rich metadata integration. Key fields include:</p>
<ul>
<li><strong>INFO</strong>: This column contains site-level annotations such as functional impacts or allele frequencies.</li>
<li><strong>FORMAT</strong>: This column stores sample-specific details, like sequencing depth (DP) and genotype quality (GQ), with a dedicated column for each sample.</li>
</ul>
<p>To ensure efficient storage and retrieval, VCF files are compressed using <strong>BGZF (bgzip)</strong> and indexed with <strong>TBI/CSI (tabix)</strong>, allowing quick random access to specific genomic regions.</p>
</section>
<section id="genotype-representation" class="level3">
<h3 class="anchored" data-anchor-id="genotype-representation">Genotype Representation</h3>
<p>VCF employs a straightforward system to represent genotypes, using numbers to refer to the reference and alternate alleles. The <strong>reference allele</strong> is always denoted as <code>0</code>, while the first alternate allele is <code>1</code>, the second is <code>2</code>, and so on. This encoding supports diploid organisms by using combinations of alleles:</p>
<ul>
<li><p><strong>Homozygous Reference</strong>: <code>0/0</code> (e.g., A/A if A is the reference).</p></li>
<li><p><strong>Homozygous Alternative</strong>: <code>1/1</code> (e.g., G/G if G is the first alternate allele).</p></li>
<li><p><strong>Heterozygous</strong>: <code>0/1</code> or <code>1/2</code> (e.g., A/G or G/T).</p></li>
</ul>
<p>This allele numbering system simplifies the representation of complex genotypes while maintaining clarity.</p>
</section>
<section id="role-in-genomic-analysis" class="level3">
<h3 class="anchored" data-anchor-id="role-in-genomic-analysis">Role in Genomic Analysis</h3>
<p>The VCF format is a cornerstone of genomic workflows, supporting data storage, sharing, and analysis. Starting with sequencing data in FASTQ format, genomic analysis pipelines align reads (producing BAM files) and call variants, which are stored in VCF format. VCF captures both per-site details and per-sample information, ensuring that all relevant data is preserved. Its ability to handle multiple samples in a single file makes it scalable for population-level studies.</p>
</section>
<section id="tumor-specific-annotations-in-vcf" class="level3">
<h3 class="anchored" data-anchor-id="tumor-specific-annotations-in-vcf">Tumor-Specific Annotations in VCF</h3>
<p>In cancer genomics, VCF files often include additional annotations tailored for tumor samples. For example:</p>
<ul>
<li><strong>AF</strong> (Allelic Fraction) records the proportion of alternate alleles observed in a tumor sample.</li>
<li><strong>GERMQ</strong> (Germline Quality) provides a Phred-scaled quality score indicating whether alternate alleles are unlikely to be germline variants.</li>
<li><strong>PON</strong> (Panel of Normals) marks sites that are found in a reference panel of normal samples, helping to identify potential artifacts.</li>
</ul>
<p>These specialized annotations enhance the utility of VCF in clinical and research applications focused on cancer.</p>
<p><strong>Binary Call Format (BCF)</strong></p>
</section>
<section id="section-1" class="level3">
<h3 class="anchored" data-anchor-id="section-1"></h3>
<p>To further improve efficiency, the <strong>Binary Call Format (BCF)</strong> was developed as a binary version of VCF. BCF rearranges fields for faster access and compresses data more effectively, making it ideal for large-scale genomic studies. It retains all the capabilities of VCF while optimizing for speed and storage.</p>
<hr>
</section>
<section id="example-vcf-file" class="level3">
<h3 class="anchored" data-anchor-id="example-vcf-file"><strong>Example VCF File</strong></h3>
<pre><code>##fileformat=VCFv4.2
##source=VariantCallerTool
##reference=GRCh38
##INFO=&lt;ID=AF,Number=A,Type=Float,Description="Allele Frequency"&gt;
##INFO=&lt;ID=GERMQ,Number=1,Type=Integer,Description="Phred-scaled quality that ALT alleles are not germline"&gt;
##INFO=&lt;ID=PON,Number=0,Type=Flag,Description="Present in panel of normals"&gt;
##FORMAT=&lt;ID=GT,Number=1,Type=String,Description="Genotype"&gt;
##FORMAT=&lt;ID=DP,Number=1,Type=Integer,Description="Read Depth"&gt;
##FORMAT=&lt;ID=GQ,Number=1,Type=Integer,Description="Genotype Quality"&gt;
#CHROM  POS     ID      REF     ALT     QUAL    FILTER  INFO                    FORMAT      SAMPLE1     SAMPLE2
chr17   7674236 .       G       A       99      PASS    AF=0.35;GERMQ=99;PON    GT:DP:GQ    0/1:30:99   0/0:28:98
chr12   25398284 .      T       C       200     PASS    AF=0.12                 GT:DP:GQ    0/1:25:70   0/0:22:65
chr5    11234567 .      C       T       150     PASS    AF=0.50;GERMQ=80        GT:DP:GQ    1/1:45:99   0/1:18:50</code></pre>
</section>
<section id="explanation-of-each-column" class="level3">
<h3 class="anchored" data-anchor-id="explanation-of-each-column"><strong>Explanation of Each Column</strong></h3>
<p><strong>Header Lines</strong>:</p>
<p><code>##fileformat</code>: Indicates the VCF version (v4.2 in this case).</p>
<p><code>##INFO</code> and <code>##FORMAT</code>: Define metadata for <code>INFO</code> and <code>FORMAT</code> fields.</p>
<p><strong>Data Columns</strong>:</p>
<p><strong>CHROM</strong>: Chromosome name (e.g., <code>chr17</code>).</p>
<p><strong>POS</strong>: Position of the variant on the chromosome.</p>
<p><strong>ID</strong>: Variant ID (e.g., <code>.</code> means no specific ID is provided).</p>
<p><strong>REF</strong>: Reference allele at this position (e.g., <code>G</code>).</p>
<p><strong>ALT</strong>: Alternate allele(s) at this position (e.g., <code>A</code>).</p>
<p><strong>QUAL</strong>: Quality score for the variant call (e.g., <code>99</code> indicates high confidence).</p>
<p><strong>FILTER</strong>: Indicates whether the variant passed filters (e.g., <code>PASS</code>).</p>
<p><strong>INFO</strong>: Additional annotations, such as:</p>
<p><strong>AF</strong>: Allele frequency (e.g., <code>AF=0.35</code> means 35% of reads support the alternate allele).</p>
<p><strong>GERMQ</strong>: Phred-scaled quality that the variant is not germline.</p>
<p><strong>PON</strong>: Indicates the site is present in a panel of normals.</p>
<p><strong>FORMAT</strong>: Defines the per-sample fields, such as:</p>
<p><strong>GT</strong>: Genotype (e.g., <code>0/1</code> = heterozygous, <code>1/1</code> = homozygous alternate).</p>
<p><strong>DP</strong>: Read depth at the site.</p>
<p><strong>GQ</strong>: Genotype quality score.</p>
<p><strong>SAMPLES</strong>: Individual sample data, such as: - <code>SAMPLE1</code>: Tumor sample (e.g., <code>0/1:30:99</code> means heterozygous, 30 reads, and high genotype quality). - <code>SAMPLE2</code>: Normal sample for comparison.</p>
<p><strong>What This File Represents</strong></p>
<ol type="1">
<li><p><strong><code>chr17:7674236</code></strong>: A heterozygous <strong>G&gt;A</strong> mutation is observed in <strong>SAMPLE1</strong>, with an allele frequency of 35%. It is also flagged as present in a panel of normals (<strong>PON</strong>), indicating it might not be tumor-specific.</p></li>
<li><p><strong><code>chr12:25398284</code></strong>: A low-frequency <strong>T&gt;C</strong> mutation (allele frequency 12%) is observed in <strong>SAMPLE1</strong>, likely a subclonal event.</p></li>
<li><p><strong><code>chr5:11234567</code></strong>: A homozygous <strong>C&gt;T</strong> mutation in the tumor sample (<strong>SAMPLE1</strong>) but only heterozygous in the normal sample (<strong>SAMPLE2</strong>).</p></li>
</ol>
</section>
<section id="other-important-information" class="level2">
<h2 class="anchored" data-anchor-id="other-important-information"><strong>Other important information</strong></h2>
<p>A <strong>CIGAR string</strong> (Compact Idiosyncratic Gapped Alignment Report) is a sequence of operations used in SAM/BAM files to describe how a read is aligned to a reference genome. It specifies matches, mismatches, insertions, deletions, and other events in the alignment.</p>
<section id="structure-of-a-cigar-string" class="level3">
<h3 class="anchored" data-anchor-id="structure-of-a-cigar-string"><strong>Structure of a CIGAR String</strong></h3>
<p>A CIGAR string consists of a series of operations, each represented by a <strong>length</strong> (number) followed by a <strong>character</strong> (operation type).</p>
<section id="common-operations" class="level4">
<h4 class="anchored" data-anchor-id="common-operations"><strong>Common Operations:</strong></h4>
<ul>
<li><p><strong><code>M</code></strong>: Match (alignment match or mismatch).<br>
Example: <code>10M</code> = 10 bases aligned (could include mismatches).</p></li>
<li><p><strong><code>I</code></strong>: Insertion (relative to the reference).<br>
Example: <code>5I</code> = 5 bases inserted in the query sequence.</p></li>
<li><p><strong><code>D</code></strong>: Deletion (relative to the reference).<br>
Example: <code>3D</code> = 3 bases deleted in the reference sequence.</p></li>
<li><p><strong><code>S</code></strong>: Soft clipping (query sequence bases not aligned but present in the sequence).<br>
Example: <code>8S</code> = 8 bases clipped from the start or end.</p></li>
<li><p><strong><code>H</code></strong>: Hard clipping (query sequence bases not aligned and removed from the sequence).<br>
Example: <code>10H</code> = 10 bases clipped and not stored in the sequence.</p></li>
<li><p><strong><code>N</code></strong>: Skipped region (in the reference).<br>
Example: <code>100N</code> = 100 bases skipped in the reference (e.g., introns in RNA-Seq).</p></li>
<li><p><strong><code>P</code></strong>: Padding (used with insertions or deletions in multiple sequence alignment).</p></li>
<li><p><strong><code>=</code></strong>: Exact match to the reference.</p></li>
<li><p><strong><code>X</code></strong>: Mismatch to the reference.</p></li>
</ul>
<p>Examples:</p>
<p><code>Ref: ACGTACGTACGTACGT</code></p>
<p><code>Read: ACGT----ACGTACGA</code></p>
<p><code>Cigar: 4M 4D 8M</code></p>
<p><code>Ref: ACGT----ACGTACGT</code></p>
<p><code>Read: ACGTACGTACGTACGT</code></p>
<p><code>Cigar: 4M 4I 8M</code><br>
</p>
<p><code>Ref: ACTCAGTG--GT</code></p>
<p><code>Read: ACGCA-TGCAGTtagacgt</code></p>
<p><code>Cigar: 5M 1D 2M 2I 2M 7S</code></p>
</section>
</section>
<section id="key-takeaways" class="level3">
<h3 class="anchored" data-anchor-id="key-takeaways">** Key Takeaways:**</h3>
<ul>
<li><p>CIGAR strings describe how the query sequence aligns to the reference genome.</p></li>
<li><p>They are critical for understanding alignments in SAM/BAM files.</p></li>
<li><p>Tools like <code>samtools</code> or <code>IGV</code> can help visualize alignments and interpret CIGAR strings.</p></li>
</ul>
</section>
<section id="the-maf-file-format" class="level3">
<h3 class="anchored" data-anchor-id="the-maf-file-format"><strong>The MAF file format</strong></h3>
<p>MAF stands for “Mutation-Annotation Format” and is a tab-delimited text&nbsp;file containing aggregated information from VCF files (NCI-GDC).&nbsp;It aggregates lots of information – 120+ fields per mutation! You can&nbsp;review all these at:&nbsp;<a href="https://docs.gdc.cancer.gov/Data/File_Formats/MAF_Format/"><u>https://docs.gdc.cancer.gov/Data/File_Formats/MAF_Format/</u></a></p>
<p><strong>You can convert between VCF and MAF via vcf2maf tools!</strong></p>
<p>perl vcf2maf.pl –input-vcf [vcf_file] –output-maf</p>
<p>[maf_file] –vep-path /cm/shared/apps/vep/ensembl-vep-</p>
<p>release-106.1/ –vep-data /mnt/Archives/vep/106/38/ –ref-</p>
<p>fasta [fasta_file] –tumor-id [tumor] –normal-id [normal]<br>
<strong><br>
</strong></p>
</section>
</section>
<section id="ga4gh" class="level2">
<h2 class="anchored" data-anchor-id="ga4gh"><u>GA4GH</u></h2>
<p>The Global Alliance for Genomics and Health (GA4GH) is an international coalition dedicated to advancing human health by creating frameworks and standards for sharing genomic and clinical data. Its mission is to enable responsible, ethical, and secure global collaboration in genomics research and healthcare.</p>
<p>Core Mission:</p>
<ul>
<li>Establish a common framework to facilitate the sharing of genomic and clinical data.</li>
</ul>
<!-- -->
<ul>
<li>Improve human health through international collaboration and innovation.</li>
</ul>
<section id="working-groups" class="level3">
<h3 class="anchored" data-anchor-id="working-groups"><strong>Working Groups</strong></h3>
<p>GA4GH is organized into several working groups, each focusing on a specific aspect of genomic data sharing:</p>
<ul>
<li><p><strong>Clinical</strong>: Applies genomics to healthcare and medicine.</p></li>
<li><p><strong>Regulatory and Ethics</strong>: Addresses legal, ethical, and policy issues related to genomic data.</p></li>
<li><p><strong>Security</strong>: Ensures the privacy and protection of sensitive genomic data.</p></li>
<li><p><strong>Data</strong>: Develops tools, resources, and initiatives to enhance data sharing and analysis.</p></li>
</ul>
</section>
<section id="key-projects-of-the-data-working-group" class="level3">
<h3 class="anchored" data-anchor-id="key-projects-of-the-data-working-group"><strong>Key Projects of the Data Working Group</strong></h3>
<ol type="1">
<li><p><strong>Beacon Project</strong>: Tests global willingness to share genetic data.</p></li>
<li><p><strong>BRCA Challenge</strong>: Advances understanding of breast and other cancers by studying BRCA-related genetic variants.</p></li>
<li><p><strong>Matchmaker Exchange</strong>: Connects researchers with data on rare phenotypes or genotypes.</p></li>
<li><p><strong>Reference Variation</strong>: Standardizes how genomes are described to improve interpretation and assembly.</p></li>
<li><p><strong>Benchmarking</strong>: Creates toolkits for evaluating variant calling in germline, cancer, and transcriptomic data.</p></li>
<li><p><strong>File Formats</strong>: Develops and maintains standards such as&nbsp;<strong>CRAM</strong>,&nbsp;<strong>SAM/BAM</strong>, and&nbsp;<strong>VCF/BCF</strong>&nbsp;for efficient genomic data storage and processing.</p></li>
</ol>
</section>
<section id="file-format-standards" class="level3">
<h3 class="anchored" data-anchor-id="file-format-standards"><strong>File Format Standards</strong></h3>
<p>GA4GH maintains file format standards through resources like the <strong>HTS Specifications</strong> repository (<a href="#0" title="http://samtools.github.io/hts-specs/"><u>http://samtools.github.io/hts-specs/</u></a>), which supports interoperability and efficient data management in genomics.</p>
<p><strong>Additional Resources:<br>
</strong>1. <a href="https://bioinformatics.uconn.edu/resources-and-events/tutorials-2/file-formats-tutorial/"><u>File format tutorial - University of Connecticut</u></a><br>
2. <a href="https://genome.ucsc.edu/FAQ/FAQformat.html"><u>UCSC Galaxy - Data file formats</u></a><u><br>
</u>3. <a href="https://www.youtube.com/watch?v=fQqhKOtostg"><u>12 Common Bioinformatics Files Types Explained</u></a>&nbsp;(Youtube Video)<br>
</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>This work is licensed under a Creative Commons Attribution 4.0 International License. Reuse is encouraged with acknowledgement</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>